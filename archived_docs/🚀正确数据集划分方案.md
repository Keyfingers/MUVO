# 🚀 AnoVox数据集正确使用方案

**时间**: 2025-10-19  
**状态**: 🔴 紧急 - 需要重新组织数据集  

---

## 🔍 问题诊断

### 当前错误

**我们的做法**：
- ✅ 已下载：Town07（纯异常场景）
- ❌ 用于：训练模型
- ❌ 结果：模型只见过异常，无法学习正常

**训练结果**：
```
Recall: 9.57% (随机猜测)
TP: 402, FP: 0, FN: 3798, TN: 0
标签分布: 100%异常
```

### 根本原因

**Town07的设计目的**：
- 📌 **测试集** - 评估模型在极端场景下的表现
- 📌 **纯异常** - 验证模型能否识别所有异常
- 📌 **不应用于训练** - 会导致模型无法学习正常模式

---

## 📊 AnoVox数据集正确结构

### 官方Town划分

| Town | 类型 | 用途 | 场景比例 |
|------|------|------|---------|
| **Town01** | 混合 | 训练 | 正常+异常 |
| **Town02** | 混合 | 训练 | 正常+异常 |
| **Town03** | 混合 | 训练 | 正常+异常 |
| **Town04** | 混合 | 训练 | 正常+异常 |
| **Town05** | 混合 | 验证 | 正常+异常 |
| **Town06** | 混合 | 训练 | 正常+异常 |
| **Town07** | 纯异常 | **测试** | 100%异常 |
| **Town10** | 混合 | 验证 | 正常+异常 |

### 推荐划分方案

```
训练集 (70%):
├── Town01 (所有场景)
├── Town02 (所有场景)
├── Town03 (所有场景)
├── Town04 (所有场景)
└── Town06 (所有场景)

验证集 (20%):
├── Town05 (所有场景)
└── Town10 (部分场景)

测试集 (10%):
└── Town07 (全部异常 - 最终评估)
```

---

## 🎯 立即行动计划

### 步骤1: 下载混合Town数据

**需要下载**：
- ✅ Town01: `AnoVox_Dynamic_Mono_Town01.tar.gz`
- ✅ Town02: `AnoVox_Dynamic_Mono_Town02.tar.gz`
- ✅ Town03: `AnoVox_Dynamic_Mono_Town03.tar.gz`
- ✅ Town04: `AnoVox_Dynamic_Mono_Town04.tar.gz`
- ✅ Town05: `AnoVox_Dynamic_Mono_Town05.tar.gz`

**下载命令**（Zenodo链接）：
```bash
cd /root/autodl-tmp/datasets/AnoVox

# 下载Town01-05（根据实际可用空间选择）
# 每个Town约15-20GB

# 优先级：
# 1. Town01 (最重要 - 训练集基础)
# 2. Town02 (扩充训练集)
# 3. Town05 (验证集)
```

### 步骤2: 修改数据加载器

**目标**：支持多Town加载和划分

**修改文件**：`muvo/dataset/anovox_dataset.py`

**关键改动**：
```python
class AnoVoxDataset(Dataset):
    def __init__(
        self,
        data_root: str,
        split: str = 'train',
        towns: List[str] = None,  # 新增：指定Town列表
        ...
    ):
        if towns is None:
            # 默认Town划分
            if split == 'train':
                towns = ['Town01', 'Town02', 'Town03', 'Town04', 'Town06']
            elif split == 'val':
                towns = ['Town05', 'Town10']
            elif split == 'test':
                towns = ['Town07']
        
        self.towns = towns
        self.scenarios = self._scan_scenarios()
```

### 步骤3: 重新训练场景级模型

**训练配置**：
```yaml
DATASET:
  ROOT: /root/autodl-tmp/datasets/AnoVox
  TRAIN_TOWNS: ['Town01', 'Town02']  # 先用2个Town快速验证
  VAL_TOWNS: ['Town05']
  TEST_TOWNS: ['Town07']

TRAIN:
  BATCH_SIZE: 8
  EPOCHS: 30
  LR: 1e-4
```

**预期结果**：
- ✅ Recall >50% (验证集)
- ✅ TN >0 (有正常样本)
- ✅ Recall ≈95% (Town07测试集 - 应该检测出所有异常)

---

## 📈 训练流程

### Phase 1: 快速验证（2-3小时）

**数据**：
- 训练：Town01 (约1500样本)
- 验证：Town05 (约300样本)

**目标**：
- 验证Recall >0%
- 验证TN >0（有正常样本）
- 验证loss下降

### Phase 2: 完整训练（6-8小时）

**数据**：
- 训练：Town01 + Town02 + Town03 (约4500样本)
- 验证：Town05 (约300样本)

**目标**：
- 验证集Recall >70%
- 验证集F1 >0.6

### Phase 3: 最终测试

**数据**：
- 测试：Town07 (约4200样本 - 全异常)

**预期**：
- Recall ≈100% (因为全是异常)
- Precision取决于模型质量

---

## 💾 存储空间需求

### 当前状态
```
已有：Town07 - 17GB
可用空间：? GB
```

### 推荐下载顺序

**最小可用方案**（约35GB）：
1. Town01 (17GB) - 训练集核心
2. Town05 (17GB) - 验证集

**推荐方案**（约70GB）：
1. Town01 (17GB)
2. Town02 (17GB)
3. Town03 (17GB)
4. Town05 (17GB)

---

## 🎯 现在就开始

### 立即执行的命令

```bash
# 1. 检查可用空间
df -h /root/autodl-tmp/datasets

# 2. 查看Zenodo下载链接
# 访问：https://zenodo.org/records/11577567
# 找到Town01-05的下载链接

# 3. 下载Town01（最重要）
cd /root/autodl-tmp/datasets/AnoVox
wget [Town01下载链接]

# 4. 解压
tar -xzf AnoVox_Dynamic_Mono_Town01.tar.gz

# 5. 下载Town05（验证集）
wget [Town05下载链接]
tar -xzf AnoVox_Dynamic_Mono_Town05.tar.gz
```

---

## 📝 预期时间线

| 阶段 | 任务 | 预计时间 |
|------|------|---------|
| **T+0h** | 下载Town01 | 30分钟 |
| **T+0.5h** | 下载Town05 | 30分钟 |
| **T+1h** | 修改数据加载器 | 30分钟 |
| **T+1.5h** | 启动训练 | 5分钟 |
| **T+2h** | 观察前几个epoch | - |
| **T+4h** | 完整训练完成 | - |
| **T+4.5h** | 评估结果 | 30分钟 |

**总计**: 约5小时从现在到看到正确结果

---

## ✅ 成功标准

### 训练阶段
- ✅ 训练集标签分布：60-80%正常，20-40%异常
- ✅ Loss持续下降
- ✅ Recall >0% 从第一个epoch开始

### 验证阶段
- ✅ Recall >60%
- ✅ Precision >70%
- ✅ F1 >0.65

### 测试阶段（Town07）
- ✅ Recall >90% (检测出大部分异常)
- ✅ 这才是真正的成功！

---

## 🚀 下一步

**Spark大人，请您：**

1. **检查存储空间**：`df -h /root/autodl-tmp/datasets`
2. **访问Zenodo**：https://zenodo.org/records/11577567
3. **提供下载链接**：Town01和Town05的下载URL
4. **我将立即**：
   - 下载数据
   - 修改数据加载器
   - 启动正确的训练

**这次一定能成功！** 🎯

